<div class="container text-center mt-3 justify-content-center" data-controller="total">
  <% if @farmer_transaction.status == "confirmed" %>

    <div class="banner-confirmation">
      <h1>Confirmed</h1>
      <%=  @farmer_transaction.total%>
    </div>

  <% else %>
    <div class="container row ">
      <div class="col-4">
        <%= image_tag current_user.img_url, alt: "User Avatar", class: "avatar-large" %>
      </div>
      <div class="greeting col-8">
        <%= @farmer.first_name %>, choose the amount of produces you would like to sell to <%= @buyer.first_name %> <%= @buyer.last_name %>
      </div>
    </div>
  <% end %>

    <div>
      <% @buyer.buyer_preferences.each do |bp| %>
      <div>
      <% if bp.transaction_products.where(farmer_transaction_id: @farmer_transaction.id).any? %>
        <div class="d-flex card-transaction justify-content-between align-items-center">
              <%= render "shared/card-produce-farmer-transaction", product: bp.product, price: bp.price %>
        <%= bp.transaction_products.first.quantity %> KG added
        </div>
        <% else %>
          <%= simple_form_for([@farmer_transaction, TransactionProduct.new], method: :post, remote: true) do |f| %>
            <div class="d-flex card-transaction justify-content-between align-items-center">
              <%= render "shared/card-produce-farmer-transaction", product: bp.product, price: bp.price %>

                <%= f.input :quantity, input_html: { class: "rounded-input small-input mb-0"}, placeholder: "kg",
                    label_html: {class: "d-none"} %>

                <%= f.input :buyer_preference_id, as: :hidden, input_html: { value: bp.id } %>
                <%= f.button :submit, 'Sell', class: "btn-transaction-small", data: { action: "click->total#refresh" } %>
            </div>
          <% end %>
        <% end %>
      </div>
      <% end %>
    </div>

    <% unless @farmer_transaction.status == "confirmed" %>

      <div class="banner-confirmation" >
        <div class="total">
          <span data-total-target="result"> <%= @farmer_transaction.total%> </span>
        </div>
      </div>

      <%= link_to "Confirm your choices", farmer_transaction_confirmation_path(@farmer_transaction), class: "btn btn-main"%>

   <% end %>
</div>


